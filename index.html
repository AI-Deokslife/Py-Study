<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 코칭 기반 파이썬 학습</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- marked.js for rendering Markdown from AI -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- API 설정 파일 -->
    <script src="config.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .step-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .step-number {
            background-color: #10B981;
            color: white;
            border-radius: 9999px;
            width: 2rem;
            height: 2rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        #user-code-input {
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.5;
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            min-height: 200px;
            width: 100%;
            outline: none;
            transition: border-color 0.2s;
        }
        #user-code-input:focus {
            border-color: #10B981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
        }
        /* Markdown styling */
        .markdown-content ul { list-style-type: disc; margin-left: 1.5rem; }
        .markdown-content p { margin-bottom: 0.5rem; }
        .markdown-content strong { font-weight: 700; }
        .markdown-content h4 { font-weight: 700; font-size: 1.125rem; margin-top: 1rem; margin-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.25rem;}
        .markdown-content code { background-color: #e2e8f0; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-size: 0.9em;}
        .markdown-content pre { 
            margin-bottom: 1rem; 
            background-color: #1f2937; 
            color: #f9fafb;
            padding: 1.5rem; 
            border-radius: 0.5rem; 
            font-family: 'Courier New', 'Monaco', 'Consolas', monospace;
            font-size: 1.1em;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: hidden;
            border: 2px solid #374151;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
            font-family: inherit;
        }
        
        /* 모달 내 마크다운 스타일 개선 */
        .prose {
            line-height: 1.7;
            font-size: 1rem;
            color: #374151;
        }
        .prose h1, .prose h2, .prose h3, .prose h4 {
            color: #1e40af;
            font-weight: 700;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        .prose h1 { 
            font-size: 1.75rem; 
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .prose h2 { 
            font-size: 1.5rem; 
            color: #1e40af;
        }
        .prose h3 { 
            font-size: 1.25rem; 
            color: #2563eb;
        }
        .prose h4 { 
            font-size: 1.125rem; 
            color: #3b82f6;
        }
        .prose p {
            margin-bottom: 1.25rem;
            text-align: justify;
        }
        .prose ul, .prose ol {
            margin-left: 1.75rem;
            margin-bottom: 1.25rem;
        }
        .prose li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }
        .prose strong {
            font-weight: 700;
            color: #1e40af;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }
        .prose code {
            background: #f1f5f9;
            color: #dc2626;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.9em;
            font-weight: 600;
            border: 1px solid #e2e8f0;
        }
        .prose pre {
            background: #1e293b !important;
            color: #f8fafc !important;
            padding: 1.5rem;
            border-radius: 0.75rem;
            overflow-x: hidden;
            margin: 1.5rem 0;
            border: 2px solid #475569;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .prose pre code {
            background-color: transparent !important;
            color: #f8fafc !important;
            padding: 0;
            border: none;
            font-weight: 400;
            font-family: 'Courier New', 'Monaco', 'Consolas', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .prose blockquote {
            border-left: 4px solid #3b82f6;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
            font-style: italic;
            color: #1e40af;
        }

        #custom-topic-input:disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }
        
        .difficulty-radio:checked + label {
            background-color: #10B981;
            color: white;
            border-color: #10B981;
        }
        .difficulty-radio[value="리팩토링 챌린지"]:checked + label {
            background-color: #8b5cf6; /* Violet for refactoring */
            border-color: #8b5cf6;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #10B981;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="w-full max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">AI 코칭 기반 파이썬 학습</h1>
            <p class="text-gray-600 mt-2">AI 튜터의 도움을 받아 파이썬 문제를 해결해 보세요.</p>
        </header>

        <!-- Step 1: 문제 생성기 -->
        <div class="step-card">
            <div class="flex items-center mb-4">
                <span class="step-number">1</span>
                <h2 class="text-2xl font-bold">문제 생성기</h2>
            </div>

            <div class="mb-6">
                <h4 class="font-semibold text-gray-700 mb-3">난이도를 선택하세요</h4>
                <div id="difficulty-selection" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                    <div>
                        <input type="radio" id="level-beginner" name="difficulty" value="초급" class="hidden difficulty-radio" checked>
                        <label for="level-beginner" class="block text-center cursor-pointer p-3 border rounded-lg transition-colors">초급</label>
                    </div>
                    <div>
                        <input type="radio" id="level-intermediate" name="difficulty" value="중급" class="hidden difficulty-radio">
                        <label for="level-intermediate" class="block text-center cursor-pointer p-3 border rounded-lg transition-colors">중급</label>
                    </div>
                    <div>
                        <input type="radio" id="level-advanced" name="difficulty" value="고급" class="hidden difficulty-radio">
                        <label for="level-advanced" class="block text-center cursor-pointer p-3 border rounded-lg transition-colors">고급</label>
                    </div>
                    <div>
                        <input type="radio" id="level-contest" name="difficulty" value="리팩토링 챌린지" class="hidden difficulty-radio">
                        <label for="level-contest" class="block text-center cursor-pointer p-3 border rounded-lg transition-colors">리팩토링 챌린지</label>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <h4 class="font-semibold text-gray-700 mb-2">학습할 주제를 선택하세요 (하나 이상)</h4>
                <div id="topic-selection" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                    <!-- Checkboxes will be dynamically generated here -->
                </div>
                 <div class="flex items-center mt-4 col-span-full">
                    <input id="cat-etc" type="checkbox" value="기타" class="h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                    <label for="cat-etc" class="sr-only">기타</label>
                    <input id="custom-topic-input" type="text" placeholder="기타 (체크 후 직접 주제 입력)" class="ml-2 flex-grow p-2 border border-gray-300 rounded-md text-sm" disabled>
                </div>
            </div>
            <button id="generate-quiz-btn" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 flex items-center justify-center">
                 <span id="generate-btn-text">AI로 문제 생성하기</span>
                 <div id="generate-spinner" class="spinner hidden ml-2"></div>
            </button>
        </div>

        <!-- 문제 풀이 섹션 (초기에는 숨김) -->
        <div id="project-section" class="hidden">
            <!-- Step 2: 생성된 문제 -->
            <div class="step-card">
                <div class="flex items-center mb-4">
                    <span class="step-number">2</span>
                    <h2 id="quiz-title" class="text-2xl font-bold"></h2>
                </div>
                <div id="quiz-description" class="text-gray-700 markdown-content"></div>
            </div>

            <!-- Step 3: 코드 답안 입력 -->
            <div class="step-card">
                <div class="flex items-center mb-4">
                    <span class="step-number">3</span>
                    <h2 class="text-2xl font-bold">코드 답안 입력</h2>
                </div>
                <p id="code-input-guide" class="text-gray-600 mb-4"></p>
                <textarea id="user-code-input" placeholder="# 파이썬 코드를 여기에 입력하세요."></textarea>
                <div class="flex flex-wrap gap-2 mt-4">
                    <button id="ai-coach-btn" class="w-full sm:w-auto flex-grow bg-sky-500 hover:bg-sky-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                        <span id="coach-btn-text">AI 코칭 받기</span>
                        <div id="coach-spinner" class="spinner hidden ml-2"></div>
                    </button>
                    <button id="optimize-code-btn" class="w-full sm:w-auto flex-grow bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                        <span id="optimize-btn-text">✨ AI 코드 최적화 제안</span>
                        <div id="optimize-spinner" class="spinner hidden ml-2"></div>
                    </button>
                </div>
                <div id="ai-feedback" class="mt-4 bg-sky-50 p-4 rounded-lg border border-sky-200 text-sky-800 hidden markdown-content"></div>
            </div>

            <!-- Step 4: 모범 코드 답안 -->
            <div class="step-card">
                <div class="flex items-center mb-4">
                    <span class="step-number">4</span>
                    <h2 class="text-2xl font-bold">모범 코드 답안</h2>
                </div>
                 <p class="text-gray-600 mb-4">문제 해결이 끝났거나, 정답이 궁금하다면 모범 답안을 확인해 보세요.</p>
                <button id="show-answer-btn" class="w-full md:w-auto bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-6 rounded-lg transition duration-300 mb-4">
                    모범 답안 보기
                </button>
                <div id="answer-container" class="hidden space-y-6">
                    <!-- 초보자용 풀이 -->
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-6 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center mr-3 text-lg font-bold">
                                    🧑‍💻
                                </div>
                                <h4 id="beginner-answer-title" class="text-xl font-bold text-green-800"></h4>
                            </div>
                            <button id="explain-beginner-btn" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-sm flex items-center gap-2">
                                <span>✨</span>
                                <span>설명 보기</span>
                            </button>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-green-100 shadow-sm">
                            <pre style="white-space: pre-wrap; word-wrap: break-word; overflow-x: hidden;"><code id="answer-code-beginner" class="language-python"></code></pre>
                        </div>
                        <div id="explanation-beginner" class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200 hidden markdown-content"></div>
                    </div>
                    
                    <!-- 숙련자용 풀이 -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center mr-3 text-lg font-bold">
                                    🚀
                                </div>
                                <h4 id="expert-answer-title" class="text-xl font-bold text-blue-800"></h4>
                            </div>
                            <button id="explain-expert-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-sm flex items-center gap-2">
                                <span>✨</span>
                                <span>설명 보기</span>
                            </button>
                        </div>
                        <div class="bg-white rounded-lg p-4 border border-blue-100 shadow-sm">
                            <pre style="white-space: pre-wrap; word-wrap: break-word; overflow-x: hidden;"><code id="answer-code-expert" class="language-python"></code></pre>
                        </div>
                        <div id="explanation-expert" class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200 hidden markdown-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-8 text-sm text-gray-500">
            <p>&copy; 2025 Interactive Python Learning. Created by Lee Eun Deok. All rights reserved.</p>
        </footer>
    </div>

    <!-- Custom Modal for Alerts -->
    <div id="alert-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-11/12 max-w-sm text-center">
            <p id="alert-message" class="mb-4 text-lg"></p>
            <button id="alert-close-btn" class="bg-emerald-500 text-white px-6 py-2 rounded-lg">확인</button>
        </div>
    </div>

    <!-- Code Explanation Modal -->
    <div id="explanation-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 flex items-center justify-between">
                <h3 id="explanation-modal-title" class="text-xl font-bold">코드 설명</h3>
                <button id="explanation-modal-close" class="text-white hover:text-gray-200 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-white hover:bg-opacity-20 transition-colors">
                    ×
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                <div id="explanation-modal-content" class="markdown-content prose max-w-none">
                    <div class="flex items-center justify-center py-8">
                        <div class="spinner mr-3"></div>
                        <span>AI가 코드를 분석하고 있습니다...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- 초기 설정 확인 ---
        console.log("=== 애플리케이션 초기화 ===");
        console.log("APP_CONFIG 상태:", window.APP_CONFIG);
        if (window.APP_CONFIG) {
            console.log("Netlify Functions API URL:", window.APP_CONFIG.GEMINI_API_URL);
        } else {
            console.error("❌ APP_CONFIG가 로드되지 않았습니다! config.js 파일을 확인하세요.");
        }
        
        // --- DOM 요소 ---
        const projectSection = document.getElementById('project-section');
        const generateQuizBtn = document.getElementById('generate-quiz-btn');
        const generateBtnText = document.getElementById('generate-btn-text');
        const generateSpinner = document.getElementById('generate-spinner');
        const topicSelectionContainer = document.getElementById('topic-selection');
        const etcCheckbox = document.getElementById('cat-etc');
        const customTopicInput = document.getElementById('custom-topic-input');
        const quizTitle = document.getElementById('quiz-title');
        const quizDescription = document.getElementById('quiz-description');
        const codeInputGuide = document.getElementById('code-input-guide');
        const userCodeInput = document.getElementById('user-code-input');
        const aiCoachBtn = document.getElementById('ai-coach-btn');
        const coachBtnText = document.getElementById('coach-btn-text');
        const coachSpinner = document.getElementById('coach-spinner');
        const optimizeCodeBtn = document.getElementById('optimize-code-btn');
        const optimizeBtnText = document.getElementById('optimize-btn-text');
        const optimizeSpinner = document.getElementById('optimize-spinner');
        const aiFeedback = document.getElementById('ai-feedback');
        const showAnswerBtn = document.getElementById('show-answer-btn');
        const answerContainer = document.getElementById('answer-container');
        const beginnerAnswerTitle = document.getElementById('beginner-answer-title');
        const expertAnswerTitle = document.getElementById('expert-answer-title');
        const answerCodeBeginner = document.getElementById('answer-code-beginner');
        const answerCodeExpert = document.getElementById('answer-code-expert');
        const explainBeginnerBtn = document.getElementById('explain-beginner-btn');
        const explainExpertBtn = document.getElementById('explain-expert-btn');
        const explanationBeginner = document.getElementById('explanation-beginner');
        const explanationExpert = document.getElementById('explanation-expert');
        const alertModal = document.getElementById('alert-modal');
        const alertMessage = document.getElementById('alert-message');
        const alertCloseBtn = document.getElementById('alert-close-btn');
        
        // 설명 모달 요소들
        const explanationModal = document.getElementById('explanation-modal');
        const explanationModalTitle = document.getElementById('explanation-modal-title');
        const explanationModalContent = document.getElementById('explanation-modal-content');
        const explanationModalClose = document.getElementById('explanation-modal-close');
        
        let currentQuiz = null;

        // --- 함수 ---
        
        // 커스텀 알림창 표시
        function showAlert(message) {
            alertMessage.textContent = message;
            alertModal.classList.remove('hidden');
        }
        alertCloseBtn.addEventListener('click', () => alertModal.classList.add('hidden'));

        // 설명 모달 관련 함수들
        function showExplanationModal(title, isLoading = true, type = 'default') {
            explanationModalTitle.textContent = title;
            
            // 타입별 색상 설정
            const colors = {
                beginner: {
                    primary: '#10b981',
                    secondary: '#065f46',
                    bg: 'from-green-500 to-emerald-600',
                    spinner: 'border-green-200 border-t-green-500',
                    dots: 'bg-green-400'
                },
                expert: {
                    primary: '#3b82f6',
                    secondary: '#1e3a8a',
                    bg: 'from-blue-500 to-indigo-600',
                    spinner: 'border-blue-200 border-t-blue-500',
                    dots: 'bg-blue-400'
                },
                default: {
                    primary: '#6366f1',
                    secondary: '#4338ca',
                    bg: 'from-blue-500 to-purple-600',
                    spinner: 'border-blue-200 border-t-blue-500',
                    dots: 'bg-blue-400'
                }
            };
            
            const color = colors[type] || colors.default;
            
            // 헤더 색상 업데이트
            const modalHeader = explanationModal.querySelector('.bg-gradient-to-r');
            modalHeader.className = `bg-gradient-to-r ${color.bg} text-white p-6 flex items-center justify-between`;
            
            if (isLoading) {
                explanationModalContent.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-12 px-6">
                        <div class="relative mb-6">
                            <div class="w-16 h-16 border-4 ${color.spinner} rounded-full animate-spin"></div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-8 h-8 rounded-full opacity-20" style="background-color: ${color.primary};"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">✨ AI가 코드를 분석하고 있습니다</h4>
                            <p class="text-gray-600 text-sm">잠시만 기다려 주세요. 곧 자세한 설명을 제공해드릴게요!</p>
                        </div>
                        <div class="mt-6 flex space-x-1">
                            <div class="w-2 h-2 ${color.dots} rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                            <div class="w-2 h-2 ${color.dots} rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                            <div class="w-2 h-2 ${color.dots} rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                        </div>
                    </div>
                `;
            }
            explanationModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // 스크롤 방지
        }
        
        function hideExplanationModal() {
            explanationModal.classList.add('hidden');
            document.body.style.overflow = 'auto'; // 스크롤 복원
        }
        
        function setExplanationContent(content, type = 'default') {
            const parsedContent = marked.parse(content, { 
                sanitize: false,
                gfm: true,
                breaks: true
            });
            
            // 타입별 배경 색상 설정
            const bgColors = {
                beginner: 'bg-gradient-to-br from-green-50 to-emerald-50 border-green-100',
                expert: 'bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-100', 
                default: 'bg-gradient-to-br from-purple-50 to-indigo-50 border-purple-100'
            };
            
            const bgClass = bgColors[type] || bgColors.default;
            
            explanationModalContent.innerHTML = `
                <div class="${bgClass} rounded-xl p-6 border shadow-sm">
                    <div class="prose prose-blue max-w-none">
                        ${parsedContent}
                    </div>
                </div>
            `;
        }
        
        // 모달 닫기 이벤트
        explanationModalClose.addEventListener('click', hideExplanationModal);
        explanationModal.addEventListener('click', (e) => {
            if (e.target === explanationModal) {
                hideExplanationModal();
            }
        });
        
        // ESC 키로 모달 닫기
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideExplanationModal();
            }
        });

        // 주제 선택 체크박스 동적 생성
        function populateTopics() {
            const categories = ['입출력', '변수와 연산', '조건문', '반복문', '리스트', '문자열', '함수', '딕셔너리', '파일 처리'];
            topicSelectionContainer.innerHTML = categories.map(cat => `
                <div class="flex items-center">
                    <input id="cat-${cat}" type="checkbox" value="${cat}" class="h-4 w-4 rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
                    <label for="cat-${cat}" class="ml-2 block text-sm text-gray-900">${cat}</label>
                </div>
            `).join('');
        }

        // 새로운 문제 생성 UI 업데이트
        function updateUIWithNewQuiz(quiz) {
            currentQuiz = quiz;
            quizTitle.textContent = quiz.title;
            
            const cleanedDescription = quiz.description.replace(/\u00A0/g, ' ');
            
            if(quiz.inefficient_code) { // 리팩토링 챌린지인 경우
                quizDescription.innerHTML = marked.parse(cleanedDescription, { sanitize: false }) + 
                '<h4>개선할 코드 👇</h4><pre><code class="language-python">' + quiz.inefficient_code + '</code></pre>';
                quizDescription.querySelectorAll('pre code').forEach(block => hljs.highlightElement(block));
                codeInputGuide.textContent = "위에 제시된 '개선할 코드'를 더 효율적이고 읽기 쉽게 리팩토링하여 아래에 작성해 보세요.";
            } else { // 일반 문제인 경우
                // HTML 태그를 허용하도록 marked 설정
                quizDescription.innerHTML = marked.parse(cleanedDescription, { 
                    sanitize: false,
                    gfm: true,
                    breaks: true
                });
                codeInputGuide.textContent = "생성된 문제에 대한 답안 코드를 작성해 보세요. 막히는 부분이 있다면 AI 코칭을 받아보세요.";
            }
            
            projectSection.classList.remove('hidden');
            
            userCodeInput.value = '';
            aiFeedback.classList.add('hidden');
            aiFeedback.innerHTML = '';
            answerContainer.classList.add('hidden');
            showAnswerBtn.textContent = "모범 답안 보기";
            explanationBeginner.classList.add('hidden');
            explanationExpert.classList.add('hidden');
        }
        
        // AI에게 문제 생성 요청
        async function fetchAIQuiz(topics, difficulty) {
            console.log("=== fetchAIQuiz 함수 시작 ===");
            console.log("전달받은 topics:", topics);
            console.log("전달받은 difficulty:", difficulty);
            
            generateBtnText.textContent = "AI가 문제를 만드는 중...";
            generateSpinner.classList.remove('hidden');
            generateQuizBtn.disabled = true;

            let prompt;
            if (difficulty === '리팩토링 챌린지') {
                prompt = `파이썬 코드 리팩토링 챌린지 문제를 생성해주세요. 주제: ${topics.join(', ')}

다음 요소들을 포함해주세요:
1. 코드의 목적을 설명하는 문제 설명
2. 올바르게 작동하지만 비효율적인 코드 (느리거나 읽기 어렵거나 파이썬답지 않은 코드)
3. 개선된 효율적이고 파이썬다운 해결책

다음 JSON 형식으로만 응답해주세요:
{"id": "고유_아이디", "category": "${topics[0]}", "title": "리팩토링 챌린지: 제목", "description": "마크다운으로 작성된 문제 설명", "inefficient_code": "비효율적인 파이썬 코드", "refactored_code": "개선된 파이썬 코드"}

중요사항:
- 모든 텍스트는 한글로 작성
- JSON 문자열에서 줄바꿈은 \\n으로 이스케이프
- description에는 마크다운 형식 사용`;
            } else {
                // 랜덤 요소들 생성
                const randomSeed = Date.now() + Math.random();
                const contexts = ['게임', '음식', '여행', '쇼핑', '학교', '회사', '병원', '은행', '도서관', '카페', '영화관', '공원', '헬스장', '미용실', '서점', '마트', '편의점', '주식', '암호화폐', '날씨', '교통', '부동산', '스포츠', '음악', '예술', '요리', '패션', '건강', '취미'];
                const scenarios = ['관리 시스템', '계산기', '분석 도구', '추천 시스템', '게임', '시뮬레이터', '변환기', '검색 엔진', '챗봇', '플래너', '트래커', '모니터링 도구', '예측기', '생성기', '최적화 도구'];
                const dataTypes = ['점수', '가격', '시간', '거리', '온도', '인원수', '순위', '평점', '수량', '비율', '확률', '속도', '크기', '무게', '나이'];
                
                const randomContext = contexts[Math.floor(Math.random() * contexts.length)];
                const randomScenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                const randomDataType = dataTypes[Math.floor(Math.random() * dataTypes.length)];
                
                // 주제별 특화 방향성 (주제에만 집중)
                const topicDirections = {
                    '입출력': ['입력 검증', '형식 변환', '사용자 인터페이스', '데이터 수집', '결과 표시', '포맷팅'],
                    '변수와 연산': ['변수 선언', '데이터 타입', '산술 연산', '논리 연산', '변수 활용'],
                    '조건문': ['조건 판단', '분기 처리', '상태 확인', '조건부 실행', '논리 연산'],
                    '반복문': ['반복 실행', '순환 처리', '반복 제어', '루프 활용', '반복 패턴'],
                    '리스트': ['리스트 조작', '데이터 저장', '리스트 관리', '요소 처리', '리스트 연산'],
                    '문자열': ['문자열 처리', '텍스트 조작', '문자열 분석', '텍스트 변환', '문자열 연산'],
                    '함수': ['함수 정의', '코드 모듈화', '함수 호출', '매개변수 활용', '반환값 처리'],
                    '딕셔너리': ['딕셔너리 조작', '키-값 관리', '데이터 구조', '해시 테이블', '딕셔너리 연산'],
                    '파일 처리': ['파일 읽기', '파일 쓰기', '파일 관리', '데이터 저장', '파일 시스템']
                };
                
                const mainTopic = topics[0];
                const directions = topicDirections[mainTopic] || ['일반적인 프로그래밍'];
                const randomDirection = directions[Math.floor(Math.random() * directions.length)];
                
                // 파이썬 학습 단계별 위계 정의
                const learningHierarchy = ['입출력', '변수와 연산', '조건문', '반복문', '리스트', '문자열', '함수', '딕셔너리', '파일 처리'];
                const selectedTopicIndices = topics.map(topic => learningHierarchy.indexOf(topic)).filter(index => index !== -1);
                const maxTopicLevel = Math.max(...selectedTopicIndices);
                const allowedConcepts = learningHierarchy.slice(0, maxTopicLevel + 1);
                
                // 난이도별 세부 정의
                const difficultySpecs = {
                    '초급': {
                        description: '파이썬 입문자 수준 (처음 파이썬을 접하며 기본 문법을 배우는 단계)',
                        complexity: '매우 단순한 로직, 기본 문법만 사용',
                        concepts: '선택된 주제의 가장 기본적인 개념만',
                        variables: '단순하고 직관적인 변수명',
                        logic: '한번에 하나의 개념만 다루는 단순한 문제'
                    },
                    '중급': {
                        description: '파이썬 교재 1~3회독 수준 (기본 문법을 이해하고 응용할 수 있는 단계)',
                        complexity: '여러 개념을 조합한 로직, 중간 수준의 문제 해결',
                        concepts: '선택된 주제의 핵심 기능들을 조합',
                        variables: '의미있는 변수명과 약간의 복잡성',
                        logic: '2-3개의 개념을 조합한 실용적 문제'
                    },
                    '고급': {
                        description: '프로그래머/대회 준비 수준 (고급 기법과 최적화를 고려하는 단계)',
                        complexity: '복잡한 로직, 효율성과 최적화 고려',
                        concepts: '선택된 주제의 고급 기법과 트릭들',
                        variables: '효율적이고 전문적인 변수명',
                        logic: '복합적 사고가 필요한 도전적 문제'
                    }
                };
                
                const currentSpec = difficultySpecs[difficulty];
                
                prompt = `**시드: ${randomSeed}**

${difficulty} 난이도의 완전히 새로운 파이썬 문제를 생성하세요.

**난이도 정의:**
- **${difficulty}**: ${currentSpec.description}
- **복잡도**: ${currentSpec.complexity}
- **개념 사용**: ${currentSpec.concepts}
- **변수 스타일**: ${currentSpec.variables}
- **문제 특성**: ${currentSpec.logic}

**선택된 학습 주제: ${topics.join(', ')}**
**허용되는 모든 개념: ${allowedConcepts.join(', ')} (이전 단계 포함)**
**문제 방향성**: ${randomDirection}
**상황 키워드**: ${randomContext}, ${randomScenario}, ${randomDataType}

**엄격한 주제 및 난이도 규칙:**

1. **주제 제한 (매우 중요)**:
   - 주요 초점: ${topics.join(', ')} (선택된 주제에 80% 이상 집중)
   - 허용 개념: ${allowedConcepts.join(', ')} (학습 단계상 이전에 배운 것들)
   - 절대 금지: ${learningHierarchy.slice(maxTopicLevel + 1).join(', ')} (아직 배우지 않은 개념들)

2. **난이도별 세부 요구사항**:
   
   **초급 (입문자)**:
   - 한 번에 하나의 주요 개념만 다루기
   - 가장 기본적인 문법만 사용
   - 5-10줄 내의 단순한 코드
   - 직관적으로 이해 가능한 문제
   
   **중급 (교재 1~3회독)**:
   - 2-3개 개념을 조합한 문제
   - 약간의 논리적 사고가 필요
   - 10-20줄 정도의 코드
   - 실생활 응용 가능한 문제
   
   **고급 (프로그래머/대회 준비)**:
   - 복합적 사고가 필요한 문제
   - 효율성과 최적화 고려
   - 20줄 이상의 복잡한 로직
   - 도전적이고 창의적 문제

**코드 레벨별 요구사항:**

1. **초보자 코드 (answer_beginner)**:
   - ${difficulty} 수준에 맞는 가장 직관적인 해결방식
   - 선택된 주제의 기본 개념만 사용
   - 명확하고 읽기 쉬운 코드
   - 복잡한 기법 사용 금지

2. **숙련자 코드 (answer_expert)**:
   - ${difficulty} 수준에서 가능한 최적화된 코드
   - 허용된 개념 범위 내에서 최고 수준의 기법 활용
   - 파이썬다운 스타일과 효율성 모두 고려
   - 초보자 코드보다 명확히 우수한 접근법

**문제 생성 체크리스트:**
1. ✅ 선택된 주제(${topics.join(', ')})가 문제의 핵심인가?
2. ✅ ${difficulty} 수준에 적합한 복잡도인가?
3. ✅ 허용되지 않은 개념(${learningHierarchy.slice(maxTopicLevel + 1).join(', ')})을 사용하지 않았는가?
4. ✅ 두 코드의 수준 차이가 학습에 도움이 되는가?
5. ✅ ${randomContext} 상황의 ${randomScenario} 문제로 구성되었는가?

다음 JSON으로만 응답:
{"id": "${randomSeed}", "category": "${topics[0]}", "title": "문제 제목", "description": "상세한 문제 설명 (마크다운)", "answer_beginner": "초보자 코드", "answer_expert": "고급 코드"}

모든 텍스트는 한글로, JSON 내 줄바꿈은 \\n으로 이스케이프하세요.`;
            }

            try {
                console.log("=== API 요청 준비 ===");
                console.log("생성된 프롬프트:", prompt);
                
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = window.APP_CONFIG.GEMINI_API_URL;
                
                console.log("=== API 요청 실행 ===");
                console.log("API URL:", apiUrl);
                console.log("요청 페이로드:", JSON.stringify(payload, null, 2));
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                console.log("API 응답 상태:", response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error("API 응답 오류:", errorText);
                    throw new Error(`API request failed: ${response.status} ${response.statusText} - ${errorText}`);
                }
                
                const result = await response.json();
                console.log("API 응답 데이터:", result);
                
                if (result.candidates && result.candidates.length > 0) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    console.log("원본 AI 응답:", rawText);
                    
                    const jsonText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
                    console.log("정제된 JSON 텍스트:", jsonText);
                    
                    try {
                        const newQuiz = JSON.parse(jsonText);
                        console.log("파싱된 퀴즈 데이터:", newQuiz);
                        updateUIWithNewQuiz(newQuiz);
                    } catch (parseError) {
                        console.error("JSON 파싱 오류:", parseError);
                        console.error("파싱 실패한 텍스트:", jsonText);
                        throw new Error("AI 응답을 JSON으로 파싱할 수 없습니다: " + parseError.message);
                    }
                } else {
                    console.error("유효한 candidates가 없음:", result);
                    throw new Error("API에서 유효한 응답을 받지 못했습니다.");
                }

            } catch (error) {
                console.error("Custom Quiz Generation Error:", error);
                console.error("Error details:", {
                    message: error.message,
                    stack: error.stack,
                    topics: topics,
                    difficulty: difficulty
                });
                
                // 더 구체적인 오류 메시지 표시
                let errorMsg = "AI 문제 생성 중 오류가 발생했습니다.";
                if (error.message.includes('429')) {
                    errorMsg = "오늘의 API 사용량을 초과했습니다. 내일 다시 시도하거나 새로운 API 키를 사용해주세요.";
                } else if (error.message.includes('fetch')) {
                    errorMsg = "네트워크 연결을 확인해주세요.";
                } else if (error.message.includes('JSON')) {
                    errorMsg = "AI 응답 형식에 문제가 있습니다. 다시 시도해주세요.";
                } else if (error.message.includes('500')) {
                    errorMsg = "서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.";
                }
                showAlert(errorMsg);
            } finally {
                generateBtnText.textContent = "AI로 문제 생성하기";
                generateSpinner.classList.add('hidden');
                generateQuizBtn.disabled = false;
            }
        }
        
        // 메인 문제 생성 함수
        function handleGenerateQuiz() {
            console.log("=== 문제 생성 시작 ===");
            const selectedDifficulty = document.querySelector('input[name="difficulty"]:checked').value;
            const selectedCategories = Array.from(document.querySelectorAll('#topic-selection input:checked')).map(cb => cb.value);
            
            console.log("선택된 난이도:", selectedDifficulty);
            console.log("선택된 카테고리:", selectedCategories);
            
            if (etcCheckbox.checked) {
                const customTopic = customTopicInput.value.trim();
                if (customTopic) {
                    selectedCategories.push(customTopic);
                } else {
                    showAlert("'기타' 주제를 직접 입력해주세요.");
                    return;
                }
            }
            
            if (selectedCategories.length === 0) {
                showAlert("학습할 주제를 하나 이상 선택해주세요.");
                return;
            }
            
            // Netlify Functions 엔드포인트 확인
            console.log("API URL:", window.APP_CONFIG?.GEMINI_API_URL);
            
            fetchAIQuiz(selectedCategories, selectedDifficulty);
        }

        // 모달용 AI 설명 함수
        async function getAIExplanation(prompt) {
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiUrl = window.APP_CONFIG.GEMINI_API_URL;
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API request failed: ${response.statusText}`);
            }

            const result = await response.json();
            
            if (result.candidates && result.candidates.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error("Invalid API response");
            }
        }

        // 범용 AI 피드백 함수
        async function getAIFeedback(prompt, button, buttonText, spinner, outputElement) {
            const userCode = userCodeInput.value.trim();
            if (!userCode && (button === aiCoachBtn || button === optimizeCodeBtn)) {
                showAlert("코드를 먼저 작성해주세요.");
                return;
            }
            if (!currentQuiz) {
                 showAlert("먼저 문제를 생성해주세요.");
                return;
            }

            button.disabled = true;
            const originalText = buttonText ? buttonText.textContent : button.textContent;
            if (buttonText) {
                buttonText.textContent = "AI 분석 중...";
            } else {
                button.textContent = "AI 분석 중...";
            }
            if (spinner) spinner.classList.remove('hidden');
            outputElement.classList.add('hidden');

            try {
                 let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                 const payload = { contents: chatHistory };
                 const apiUrl = window.APP_CONFIG.GEMINI_API_URL;
                 
                 const response = await fetch(apiUrl, {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(payload)
                 });

                if (!response.ok) throw new Error(`API request failed: ${response.statusText}`);

                 const result = await response.json();
                 
                 if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    outputElement.innerHTML = marked.parse(text, { 
                        sanitize: false,
                        gfm: true,
                        breaks: true
                    });
                 } else {
                    throw new Error("Invalid API response.");
                 }

            } catch (error) {
                console.error("AI Feedback Error:", error);
                showAlert("AI 분석 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
                outputElement.innerHTML = '';
            } finally {
                button.disabled = false;
                if (buttonText) {
                    buttonText.textContent = originalText;
                } else {
                    button.textContent = originalText;
                }
                if (spinner) spinner.classList.add('hidden');
                if (outputElement.innerHTML) {
                    outputElement.classList.remove('hidden');
                }
            }
        }

        // 모범 답안 표시/숨기기
        function toggleAnswer() {
            if (!currentQuiz) {
                showAlert("먼저 문제를 생성해주세요.");
                return;
            }
            
            const isHidden = answerContainer.classList.toggle('hidden');
            if (!isHidden) {
                if (currentQuiz.inefficient_code) { // 리팩토링 챌린지
                    beginnerAnswerTitle.textContent = '🧑‍💻 개선 전 코드';
                    answerCodeBeginner.textContent = currentQuiz.inefficient_code;
                    expertAnswerTitle.textContent = '🚀 개선 후 코드 (모범 답안)';
                    answerCodeExpert.textContent = currentQuiz.refactored_code;
                } else { // 일반 문제
                    beginnerAnswerTitle.textContent = '🧑‍  초보자용 풀이';
                    answerCodeBeginner.textContent = currentQuiz.answer_beginner;
                    expertAnswerTitle.textContent = '🚀 숙련자용 풀이';
                    answerCodeExpert.textContent = currentQuiz.answer_expert;
                }

                hljs.highlightElement(answerCodeBeginner);
                hljs.highlightElement(answerCodeExpert);
                showAnswerBtn.textContent = "답안 숨기기";

            } else {
                showAnswerBtn.textContent = "모범 답안 보기";
            }
        }
        
        // --- 이벤트 리스너 및 초기화 ---
        populateTopics();
        
        generateQuizBtn.addEventListener('click', handleGenerateQuiz);
        etcCheckbox.addEventListener('change', () => {
            customTopicInput.disabled = !etcCheckbox.checked;
            if (etcCheckbox.checked) {
                customTopicInput.focus();
            }
        });

        aiCoachBtn.addEventListener('click', () => {
            const prompt = `You are a friendly Python coding tutor. A student is solving the following problem: "${currentQuiz.description}". The student's code is: \`\`\`python\n${userCodeInput.value}\n\`\`\` Please provide hints without giving away the answer. Point out errors, suggest better approaches, or praise good parts. Use Korean with a friendly tone. **Format your response in Markdown.** Never show the complete answer code.`;
            getAIFeedback(prompt, aiCoachBtn, coachBtnText, coachSpinner, aiFeedback);
        });

        optimizeCodeBtn.addEventListener('click', () => {
            const prompt = `You are an expert Python code optimizer. Analyze the following Python code in the context of the problem: "${currentQuiz.description}". The student's code is: \`\`\`python\n${userCodeInput.value}\n\`\`\` Provide specific suggestions to improve its performance (time complexity, space complexity) and make it more Pythonic. Explain why your suggestions are better. Use Korean with a professional but easy-to-understand tone. **Format your response in Markdown.**`;
            getAIFeedback(prompt, optimizeCodeBtn, optimizeBtnText, optimizeSpinner, aiFeedback);
        });

        explainBeginnerBtn.addEventListener('click', async () => {
            const code = currentQuiz.inefficient_code || currentQuiz.answer_beginner;
            const title = currentQuiz.inefficient_code ? '🧑‍💻 개선 전 코드 설명' : '🧑‍💻 초보자용 풀이 설명';
            const problemDescription = currentQuiz.description;
            
            showExplanationModal(title, true, 'beginner');
            
            const prompt = `다음은 파이썬 초보자를 위한 코드 설명입니다. 매우 자세하고 친절하게 설명해주세요.

**문제:**
${problemDescription}

**초보자용 코드:**
\`\`\`python
${code}
\`\`\`

다음과 같은 구조로 초보자가 이해하기 쉽게 설명해주세요:

## 🎯 문제 이해하기
- 이 문제가 무엇을 요구하는지 쉬운 말로 설명
- 입력과 출력이 무엇인지 명확히 설명

## 📝 해결 전략
- 문제를 어떻게 단계별로 접근했는지
- 왜 이런 방식으로 해결했는지 이유 설명

## 🔍 코드 한 줄씩 분석
코드의 각 줄을 다음과 같이 분석해주세요:
- **각 줄이 하는 일**: 구체적으로 무엇을 하는지
- **왜 필요한지**: 이 줄이 왜 필요한지 이유 설명
- **변수의 역할**: 사용된 변수가 무엇을 의미하는지
- **주의사항**: 초보자가 놓치기 쉬운 부분이나 주의할 점

## 💡 핵심 개념 설명
- 이 코드에서 사용된 파이썬 기본 개념들 (반복문, 조건문, 함수, 리스트 등)
- 각 개념이 어떻게 작동하는지 초보자 수준에서 설명
- 비슷한 상황에서 어떻게 응용할 수 있는지

## 🚀 실행 과정 시뮬레이션
- 예시 입력을 사용해서 코드가 어떻게 실행되는지 단계별로 추적
- 각 단계에서 변수 값이 어떻게 변하는지 보여주기
- 최종 결과가 어떻게 나오는지 설명

## 🤔 자주 하는 실수와 해결법
- 초보자가 이런 문제에서 자주 하는 실수들
- 디버깅 팁과 문제 해결 방법
- 코드를 테스트하는 방법

## 📚 추가 학습 포인트
- 이 문제를 통해 배울 수 있는 것들
- 관련된 다른 개념들
- 다음에 도전해볼 만한 비슷한 문제들

한글로 작성하고, 초보자도 쉽게 이해할 수 있도록 친근하고 상세하게 설명해주세요. 전문 용어를 사용할 때는 반드시 쉬운 말로 풀어서 설명해주세요.`;
            
            try {
                const explanation = await getAIExplanation(prompt);
                setExplanationContent(explanation, 'beginner');
            } catch (error) {
                setExplanationContent('❌ 설명을 가져오는 중 오류가 발생했습니다. 다시 시도해주세요.', 'beginner');
            }
        });

        explainExpertBtn.addEventListener('click', async () => {
            const code = currentQuiz.refactored_code || currentQuiz.answer_expert;
            const beginnerCode = currentQuiz.inefficient_code || currentQuiz.answer_beginner;
            const title = currentQuiz.refactored_code ? '🚀 개선 후 코드 설명' : '🚀 숙련자용 풀이 설명';
            
            showExplanationModal(title, true, 'expert');
            
            const prompt = `다음은 같은 문제에 대한 두 가지 해결책입니다. 숙련자용 코드를 전문가 관점에서 상세히 분석해주세요.

**초보자/개선 전 코드:**
\`\`\`python
${beginnerCode}
\`\`\`

**숙련자/개선 후 코드:**
\`\`\`python
${code}
\`\`\`

다음 관점에서 숙련자용 코드를 분석해주세요:

## 🚀 고급 기법 분석
- 사용된 파이썬 고급 기법들 (리스트 컴프리헨션, 람다, 내장함수 등)
- 각 기법이 선택된 이유와 장점

## ⚡ 성능 최적화
- 시간 복잡도 개선 (Big O 분석)
- 공간 복잡도 개선
- 메모리 효율성 향상

## 🎯 파이썬다운 스타일 (Pythonic)
- 파이썬 관용구 활용
- 코드 가독성과 간결성
- PEP 8 스타일 가이드 준수

## 📊 초보자 코드와의 차이점
- 구체적인 개선 사항
- 왜 이 방식이 더 나은지
- 실제 성능 차이 예상치

## 💡 학습 포인트
- 이 코드에서 배울 수 있는 핵심 개념
- 다른 상황에서 응용할 수 있는 패턴

한글로 작성하고 마크다운 형식을 사용해주세요. 전문적이지만 이해하기 쉽게 설명해주세요.`;
            
            try {
                const explanation = await getAIExplanation(prompt);
                setExplanationContent(explanation, 'expert');
            } catch (error) {
                setExplanationContent('❌ 설명을 가져오는 중 오류가 발생했습니다. 다시 시도해주세요.', 'expert');
            }
        });

        showAnswerBtn.addEventListener('click', toggleAnswer);

    });
    </script>
</body>
</html>